<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>throttle</title>
</head>
<body>
<div style="height:500px">
    <div id="demo" style="position:fixed;"></div>
</div>
<button class="click">click</button>
<script src="js/jquery-3.1.1.js"></script>
<script>
    var COUNT = 0, demo = document.getElementById('demo');
    function testFn() {demo.innerHTML += 'testFN 被调用了 ' + ++COUNT + '次<br>';}

//    var throttle = function (fn, delay, atleast) {
//        var timer = null;
//        var previous = null;
//
//        return function () {
//            var now = +new Date();
//
//            if ( !previous ) previous = now;
//            if ( atleast && now - previous > atleast ) {
//                fn();
//                // 重置上一次开始时间为本次结束时间
//                previous = now;
//                clearTimeout(timer);
//            } else {
//                clearTimeout(timer);
//                timer = setTimeout(function() {
//                    fn();
//                    previous = null;
//                }, delay);
//            }
//        }
//    };

//    节流函数
//    function throttle( fn , delay , atleast ){
//        let timer = null;
//        let previous = null;
//
//        return function(){
//            let now = new Date();
//            if( !null ){ previous = now ;}
//            if( now - previous >atleast && atleast){
//                fn();
//                previous = now;
//                clearTimeout(timer);
//            }else {
//                clearTimeout(timer);
//                timer = setTimeout(function(){
//                    fn();
//                    previous =null;
//                } ,delay)
//            }
//        }
//    }
    
    function throttle ( fn , delay , atleast){
        let timer = null ;
        let previous = null;
        return function () {
            let now = new Date();
            if( !previous ){ previous = now ;}
            if( atleast && now - previous >atleast ){
                fn();
                clearTimeout(timer);
            }else{
                clearTimeout(timer);
                timer = setTimeout( function(){
                    fn();
                    previous = null ;
                } ,delay )
            }
        }
    }
    $('.click').click(throttle(testFn ,2000));
//    window.onscroll = throttle(testFn, 200);
    // window.onscroll = throttle(testFn, 500, 1000);
</script>
</body>
</html>